# DNS server for Docker environment

Simple dynamic DNS server for Docker environment (mainly those with only one host) with DNS zone automatically generated from information about running containers by [docker-gen](https://github.com/jwilder/docker-gen) and Python [json-template](https://code.google.com/p/json-template/) and then served to clients by [dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html).

Can be used as very simple implementation of service discovery. Still probably better than Docker links mechanism, because they are everything but dynamic :)

Usage:

```
docker run \
  -p 172.17.42.1:53:53/tcp \
  -p 172.17.42.1:53:53/udp \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -e DNS_ROOT=docker.local \
  -e DNS_ENV= \
  -e DNS_FORWARDER=8.8.8.8 \
  -e DNS_AUTH_TTL=0 \
  -e DNS_LOG_QUERIES=0 \
  jmarsik/dns
```

Environment variables:

- __DNS_ROOT__ - domain name used for generated DNS zone, default is _docker.local_
- __DNS_ENV__ - environment part of generated DNS zone domain name, see example below, default is _empty_
- __DNS_FORWARDER__ - IP address of DNS server that will be used as a forwarder for recursive queries, default is _8.8.8.8_
- __DNS_AUTH_TTL__ - TTL returned for records in generated DNS zone, default is _0_ (which forces clients not to cache those records)
- __DNS_LOG_QUERIES__ - dnsmasq will log all queries, you can see them in _docker logs_ output, default is _0_

Multiple records are generated for each running container:

- \<container name\>
- \<container name\>.\<root domain\>
- \<container hostname including domain\>
- when DNS_ENV is specified:
  - \<container name\>.\<environment\>.\<root domain\>
  - \<container name\>.\<container image repository\>.\<environment\>.\<root domain\> - should be the same record as generated by [SkyDock](https://github.com/crosbymichael/skydock)
