{{ $dns_env_root := hostEnviron "DNS_ROOT" }}{{ $dns_root := or $dns_env_root "docker" }}
auth-server={{ $dns_root }},docker0
log-facility=-
log-queries
domain={{ $dns_root }}
auth-zone={{$dns_root}},docker0
no-hosts
no-resolv
domain-needed
bogus-priv
server=8.8.8.8

# autogenerated hosts starts here
{{ range $name, $container := groupBy $ ".Name" }}{{ $container := first $container }}
{{/* $name */}}{{/* jsonPretty $container */}}
{{ with $address := first $container.Addresses }}
{{ $hostname := $container.Hostname }}
{{ $internal_ip := $address.IP }}
{{ if $internal_ip }}
host-record={{ $name }},{{ $name }}.{{$dns_root}},{{ $internal_ip }}
{{ if ne $hostname $name }}
cname={{ $hostname }},{{ $name }}
{{ end }}
{{ with $dns_env := hostEnviron "DNS_ENVIRON" }}
cname={{ $name }}.{{ $dns_env }}.{{ $dns_root }},{{ $name }}
cname={{ $name }}.{{ $container.Image.Repository }}.{{ $dns_env }}.{{ $dns_root }},{{ $name }}
{{ end }}
# cname={{ stringHead $container.ID 12 }},{{ $hostname }}
{{ end }}{{ end }}{{ end }}
# autogenerated hosts ends here
